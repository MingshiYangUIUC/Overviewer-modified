#!/bin/bash

if [ "$#" -ne 2 ]; then 
	echo "[Usage] _run <start_idx> <end_idx>"
	exit
fi

mkdir ../results

for (( x="$1"; x<"$2"; x++ ))
  do
	echo "Start a render..."
	echo $x
	
	# delete world files and overviewer output files
	rm -r server/world
	mkdir server/world
	mkdir server/world/datapacks
	cp auto-stop-pack.zip server/world/datapacks/

  # add/replace the seed in server.properties. seed of seed is $x
	# start server in another shell so it can be "stopped" by command
	cd server
	python3 ./seed_fixed.py $x
	java -Xms2048M -Xmx2048M -jar ./server.jar --nogui
	cd ../
	# last_pid=$!

	# wait for server to generate world and "stop" it, adjust this delay (sec) based on device performance
	# sleep $[40]
	# kill -KILL $last_pid
	
	# call the overviewer            ########################################## CHANGE THESE BELOW ##########################################
	cd Minecraft-Overviewer-master
	python3 ./build/scripts-3.7/overviewer.py ../server/world ../Out

	# go back 
	cd ../

	#	and save some files generated by modified overviewer
	mv ./Out/hdimage.png saved/hdimage$x.png
	# mv ./Out/worldsummary.txt saved/worldsummary$x.txt
	# mv ./Out/worldrarity.txt saved/worldrarity$x.txt
	mv ./Out/worldfeatures.txt saved/worldfeatures$x.txt
	mv ./Out/worldfeatures.json saved/worldfeatures$x.json

	#	below saves some output of default overviewer, and png-it can be used to generate hd image using items in this folder
	#move Out\world-lighting saved\world-lighting%%x

	# generate final image and save in parent dir
	python3 ./TextOverlay/main.py $x ./saved ../results
	
	echo "Saved world data and deleted temporary data, end this render..."
 done


